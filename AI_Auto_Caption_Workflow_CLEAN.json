{
  "name": "AI Auto Caption + Hashtag - Facebook Post",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [{"field": "minutes", "minutesInterval": 5}]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [5120, 1936],
      "id": "33dcb21d-7103-405e-9fd1-fbc28f91fd93",
      "name": "Cháº¡y má»—i 5 phÃºt"
    },
    {
      "parameters": {
        "documentId": {"__rl": true, "value": "YOUR_GOOGLE_SHEET_ID", "mode": "list", "cachedResultName": "Your Sheet Name"},
        "sheetName": {"__rl": true, "value": "gid=0", "mode": "list", "cachedResultName": "Sheet1"},
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [5344, 1936],
      "id": "147c7e51-1592-48fd-9f68-8a8e76dcc7f8",
      "name": "Äá»c Google Sheets",
      "credentials": {"googleSheetsOAuth2Api": {"id": "", "name": "Google Sheets account"}}
    },
    {
      "parameters": {
        "conditions": {
          "options": {"caseSensitive": true, "leftValue": "", "typeValidation": "strict", "version": 1},
          "conditions": [
            {"id": "filter-001", "leftValue": "={{ $json['Tráº¡ng_ThÃ¡i'] }}", "rightValue": "ChÆ°a Ä‘Äƒng", "operator": {"type": "string", "operation": "equals"}},
            {"id": "96d5bdac-0564-4aa4-97c3-aef1bf2af424", "leftValue": "={{ DateTime.fromFormat($json[\"NgÃ y_ÄÄƒng\"] + ' ' + $json[\"Giá»_ÄÄƒng\"], 'dd/MM/yyyy HH:mm:ss', { zone: 'Asia/Ho_Chi_Minh' }).toMillis() }}", "rightValue": "={{ DateTime.now().setZone('Asia/Ho_Chi_Minh').toMillis() }}", "operator": {"type": "number", "operation": "lte"}}
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [5568, 1936],
      "id": "8f8e4120-d494-4cf8-82a8-94ac389e5be5",
      "name": "Lá»c bÃ i cáº§n Ä‘Äƒng"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {"__rl": true, "value": "YOUR_GOOGLE_SHEET_ID", "mode": "list", "cachedResultName": "Your Sheet Name"},
        "sheetName": {"__rl": true, "value": "gid=0", "mode": "list", "cachedResultName": "Sheet1"},
        "columns": {
          "mappingMode": "defineBelow",
          "value": {"Tráº¡ng_ThÃ¡i": "Äang Ä‘Äƒng", "row_number": "={{ $json.row_number }}"},
          "matchingColumns": ["row_number"],
          "schema": [
            {"id": "Link_HÃ¬nh", "displayName": "Link_HÃ¬nh", "type": "string", "canBeUsedToMatch": true, "removed": true},
            {"id": "Page_ID", "displayName": "Page_ID", "type": "string", "canBeUsedToMatch": true, "removed": true},
            {"id": "NgÃ y_ÄÄƒng", "displayName": "NgÃ y_ÄÄƒng", "type": "string", "canBeUsedToMatch": true, "removed": true},
            {"id": "Giá»_ÄÄƒng", "displayName": "Giá»_ÄÄƒng", "type": "string", "canBeUsedToMatch": true, "removed": true},
            {"id": "Tráº¡ng_ThÃ¡i", "displayName": "Tráº¡ng_ThÃ¡i", "type": "string", "canBeUsedToMatch": true, "removed": false},
            {"id": "Link_BÃ i_Viáº¿t", "displayName": "Link_BÃ i_Viáº¿t", "type": "string", "canBeUsedToMatch": true, "removed": true},
            {"id": "row_number", "displayName": "row_number", "type": "number", "canBeUsedToMatch": true, "readOnly": true, "removed": false}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [5792, 1936],
      "id": "f3489076-af36-47f9-b8aa-35365802f691",
      "name": "Cáº­p nháº­t: Äang Ä‘Äƒng",
      "credentials": {"googleSheetsOAuth2Api": {"id": "", "name": "Google Sheets account"}}
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {"id": "assign-001", "name": "Image_URL", "value": "={{ $('Lá»c bÃ i cáº§n Ä‘Äƒng').item.json['Link_HÃ¬nh'].includes('drive.google.com') ? 'https://drive.google.com/uc?export=view&id=' + $('Lá»c bÃ i cáº§n Ä‘Äƒng').item.json['Link_HÃ¬nh'].match(/\\/d\\/([a-zA-Z0-9_-]+)/)?.[1] : $('Lá»c bÃ i cáº§n Ä‘Äƒng').item.json['Link_HÃ¬nh'] }}", "type": "string"},
            {"id": "assign-002", "name": "Page_ID", "value": "={{ $('Lá»c bÃ i cáº§n Ä‘Äƒng').item.json['Page_ID'] }}", "type": "number"},
            {"id": "assign-003", "name": "Row_Number", "value": "={{ $json['row_number'] }}", "type": "number"}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [6000, 1936],
      "id": "acd8a4ba-56b2-4133-8f2c-e4665333f301",
      "name": "Äá»c dá»¯ liá»‡u"
    },
    {
      "parameters": {
        "url": "https://serpapi.com/search.json",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {"name": "engine", "value": "google_lens"},
            {"name": "url", "value": "={{ $json.Image_URL }}"},
            {"name": "api_key", "value": "YOUR_SERPAPI_KEY"}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [6224, 1936],
      "id": "6c5e1c21-f9a2-4a0e-b5e6-dcc138f189c5",
      "name": "Google Lens - Nháº­n diá»‡n"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {"id": "extract-001", "name": "Nhan_Dien", "value": "={{ \n  (() => {\n    const data = Array.isArray($json) ? $json[0] : $json;\n    if (data?.related_content?.[0]?.query) return data.related_content[0].query;\n    if (data?.knowledge_graph?.[0]?.title) return data.knowledge_graph[0].title + (data.knowledge_graph[0].subtitle ? ' - ' + data.knowledge_graph[0].subtitle : '');\n    if (data?.visual_matches?.[0]?.title) {\n      const title = data.visual_matches[0].title;\n      const name = title.split(/\\s[-|]\\s/)[0];\n      return name.length < 50 ? name : title.substring(0, 50);\n    }\n    return 'KhÃ´ng nháº­n diá»‡n Ä‘Æ°á»£c';\n  })()\n}}", "type": "string"},
            {"id": "extract-002", "name": "Image_URL", "value": "={{ $('Äá»c dá»¯ liá»‡u').item.json.Image_URL }}", "type": "string"},
            {"id": "extract-003", "name": "Page_ID", "value": "={{ $('Äá»c dá»¯ liá»‡u').item.json.Page_ID }}", "type": "number"},
            {"id": "extract-004", "name": "Row_Number", "value": "={{ $('Äá»c dá»¯ liá»‡u').item.json.Row_Number }}", "type": "number"}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [6448, 1936],
      "id": "1f60b820-423a-45cf-9820-97e8b5dad990",
      "name": "TrÃ­ch xuáº¥t nháº­n diá»‡n"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Báº¡n lÃ  chuyÃªn gia phÃ¢n tÃ­ch hÃ¬nh áº£nh.\n\n**Káº¿t quáº£ nháº­n diá»‡n tá»« Google Lens:** {{ $json.Nhan_Dien }}\n\nHÃ£y káº¿t há»£p thÃ´ng tin trÃªn vá»›i nhá»¯ng gÃ¬ báº¡n tháº¥y trong hÃ¬nh Ä‘á»ƒ mÃ´ táº£ chi tiáº¿t:\n1. ÄÃ¢y lÃ  ai/cÃ¡i gÃ¬\n2. Trang phá»¥c, ngoáº¡i hÃ¬nh, Ä‘áº·c Ä‘iá»ƒm ná»•i báº­t\n3. Bá»‘i cáº£nh, mÃ´i trÆ°á»ng\n4. Cáº£m xÃºc hoáº·c thÃ´ng Ä‘iá»‡p\n\nTráº£ lá»i báº±ng tiáº¿ng Viá»‡t, ngáº¯n gá»n trong 3-4 cÃ¢u.",
        "options": {"systemMessage": "Báº¡n lÃ  AI phÃ¢n tÃ­ch hÃ¬nh áº£nh. Æ¯u tiÃªn sá»­ dá»¥ng thÃ´ng tin tá»« Google Lens náº¿u cÃ³, káº¿t há»£p vá»›i quan sÃ¡t trá»±c tiáº¿p Ä‘á»ƒ mÃ´ táº£ chÃ­nh xÃ¡c nháº¥t."}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [6672, 1936],
      "id": "88324176-6f29-4673-9069-8369483e38d3",
      "name": "GPT-4 Vision - MÃ´ táº£ hÃ¬nh"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Báº¡n lÃ  Content Creator chuyÃªn viáº¿t caption Facebook thu hÃºt.\n\nDá»±a vÃ o mÃ´ táº£ hÃ¬nh áº£nh sau:\n{{ $json.output }}\n\nViáº¿t cho tÃ´i:\n\n**CAPTION:**\n- Giá»ng vÄƒn: Tráº» trung, cáº£m xÃºc, gáº§n gÅ©i\n- Äá»™ dÃ i: 3-5 cÃ¢u\n- DÃ¹ng emoji á»Ÿ Ä‘áº§u dÃ²ng (ðŸŒŸ, ðŸ’«, âœ¨, ðŸŽ¶, ðŸ’•...)\n- KHÃ”NG dÃ¹ng kÃ½ tá»± * hoáº·c **\n- Káº¿t thÃºc báº±ng cÃ¢u há»i tÆ°Æ¡ng tÃ¡c hoáº·c lá»i kÃªu gá»i\n\n**HASHTAG:**\n- Táº¡o 5-7 hashtag liÃªn quan Ä‘áº¿n ná»™i dung hÃ¬nh\n- Viáº¿t liá»n khÃ´ng dáº¥u, vÃ­ dá»¥: #phinhung #casi #amnhacviet\n- Hashtag phá»• biáº¿n, dá»… tÃ¬m kiáº¿m\n\nTráº£ vá» Ä‘Ãºng Ä‘á»‹nh dáº¡ng JSON.",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [6880, 1936],
      "id": "2a007982-32f6-4a8c-92f3-d6139c825c8c",
      "name": "AI - Viáº¿t Caption + Hashtag"
    },
    {
      "parameters": {"jsonSchemaExample": "{\n\t\"caption\": \"Ná»™i dung caption hoÃ n chá»‰nh\",\n\t\"hashtags\": \"#hashtag1 #hashtag2 #hashtag3\"\n}"},
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [6992, 2160],
      "id": "87766654-b1ea-4543-a5d8-e0be777e3c15",
      "name": "Output Parser"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {"id": "final-001", "name": "Final_Caption", "value": "={{ $json.output.caption }}\n\n{{ $json.output.hashtags }}", "type": "string"},
            {"id": "final-002", "name": "Image_URL", "value": "={{ $('TrÃ­ch xuáº¥t nháº­n diá»‡n').item.json.Image_URL }}", "type": "string"},
            {"id": "final-003", "name": "Page_ID", "value": "={{ $('TrÃ­ch xuáº¥t nháº­n diá»‡n').item.json.Page_ID }}", "type": "number"},
            {"id": "final-004", "name": "Row_Number", "value": "={{ $('TrÃ­ch xuáº¥t nháº­n diá»‡n').item.json.Row_Number }}", "type": "number"}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [7104, 1936],
      "id": "9d25a7df-95e1-4aff-9387-fe907032ac5d",
      "name": "GhÃ©p Caption + Hashtag"
    },
    {
      "parameters": {
        "httpRequestMethod": "POST",
        "graphApiVersion": "v22.0",
        "node": "={{ $json.Page_ID }}",
        "edge": "photos",
        "options": {
          "queryParameters": {
            "parameter": [
              {"name": "url", "value": "={{ $json.Image_URL }}"},
              {"name": "message", "value": "={{ $json.Final_Caption }}"}
            ]
          }
        }
      },
      "type": "n8n-nodes-base.facebookGraphApi",
      "typeVersion": 1,
      "position": [7328, 1936],
      "id": "deaf75d8-45d9-4964-a9a3-cd070d153845",
      "name": "ÄÄƒng Facebook",
      "credentials": {"facebookGraphApi": {"id": "", "name": "Facebook Graph API"}}
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {"__rl": true, "value": "YOUR_GOOGLE_SHEET_ID", "mode": "list", "cachedResultName": "Your Sheet Name"},
        "sheetName": {"__rl": true, "value": "gid=0", "mode": "list", "cachedResultName": "Sheet1"},
        "columns": {
          "mappingMode": "defineBelow",
          "value": {"row_number": "={{ $('Äá»c dá»¯ liá»‡u').item.json.Row_Number }}", "Tráº¡ng_ThÃ¡i": "ThÃ nh cÃ´ng", "Link_BÃ i_Viáº¿t": "={{ 'https://facebook.com/' + $json.id }}"},
          "matchingColumns": ["row_number"],
          "schema": [
            {"id": "Tráº¡ng_ThÃ¡i", "displayName": "Tráº¡ng_ThÃ¡i", "type": "string", "canBeUsedToMatch": true},
            {"id": "Link_BÃ i_Viáº¿t", "displayName": "Link_BÃ i_Viáº¿t", "type": "string", "canBeUsedToMatch": true, "removed": false},
            {"id": "row_number", "displayName": "row_number", "type": "number", "canBeUsedToMatch": true, "readOnly": true, "removed": false}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [7552, 1936],
      "id": "4a162822-2811-4c0a-9b5d-19ce2e22ad96",
      "name": "Cáº­p nháº­t: ThÃ nh cÃ´ng",
      "credentials": {"googleSheetsOAuth2Api": {"id": "", "name": "Google Sheets account"}}
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {"__rl": true, "value": "YOUR_GOOGLE_SHEET_ID", "mode": "list", "cachedResultName": "Your Sheet Name"},
        "sheetName": {"__rl": true, "value": "gid=0", "mode": "list", "cachedResultName": "Sheet1"},
        "columns": {
          "mappingMode": "defineBelow",
          "value": {"row_number": "={{ $('Äá»c dá»¯ liá»‡u').item.json.Row_Number }}", "Tráº¡ng_ThÃ¡i": "Tháº¥t báº¡i"},
          "matchingColumns": ["row_number"]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [7552, 2240],
      "id": "ab9b31f7-46b7-44d8-b317-15fbe16f4454",
      "name": "Cáº­p nháº­t: Tháº¥t báº¡i",
      "credentials": {"googleSheetsOAuth2Api": {"id": "", "name": "Google Sheets account"}},
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "chatId": "YOUR_TELEGRAM_CHAT_ID",
        "text": "=âœ… ÄÃƒ ÄÄ‚NG FACEBOOK THÃ€NH CÃ”NG!\nðŸ“· Link: {{ $json['Link_BÃ i_Viáº¿t'] }}\nâ° LÃºc: {{ $now.setZone('Asia/Ho_Chi_Minh').toFormat('HH:mm dd/MM/yyyy') }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [7856, 1952],
      "id": "9244f8a8-3539-4a62-886b-6c258e32421b",
      "name": "Send a text message",
      "credentials": {"telegramApi": {"id": "", "name": "Telegram Bot"}}
    },
    {
      "parameters": {"options": {}},
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [6576, 2144],
      "id": "1ac3e05f-3320-4ebd-a036-077476024d28",
      "name": "Google Gemini Chat Model",
      "credentials": {"googlePalmApi": {"id": "", "name": "Google Gemini API"}}
    },
    {
      "parameters": {"options": {}},
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [6800, 2176],
      "id": "8b1caf85-ce2e-4c47-91b9-9240938da5b7",
      "name": "Google Gemini Chat Model1",
      "credentials": {"googlePalmApi": {"id": "", "name": "Google Gemini API"}}
    },
    {
      "parameters": {
        "content": "## ðŸš€ AI Auto Caption + Hashtag - Facebook Post\n\n### âœ¨ TÃ­nh nÄƒng:\n- ðŸ” Google Lens nháº­n diá»‡n tá»± Ä‘á»™ng\n- âœï¸ AI viáº¿t caption (Gemini)\n- #ï¸âƒ£ AI tá»± táº¡o hashtag\n- â° Tá»± Ä‘á»™ng theo lá»‹ch\n- ðŸ“± ThÃ´ng bÃ¡o Telegram\n\n---\n\n### ðŸ“‹ Google Sheets - 6 Cá»˜T:\n\n| Cá»™t | TÃªn | MÃ´ táº£ |\n|-----|-----|-------|\n| A | Link_HÃ¬nh | URL hÃ¬nh áº£nh hoáº·c Google Drive link |\n| B | Page_ID | ID Facebook Page |\n| C | NgÃ y_ÄÄƒng | Format: dd/MM/yyyy |\n| D | Giá»_ÄÄƒng | Format: HH:mm:ss |\n| E | Tráº¡ng_ThÃ¡i | ChÆ°a Ä‘Äƒng/Äang Ä‘Äƒng/ThÃ nh cÃ´ng/Tháº¥t báº¡i |\n| F | Link_BÃ i_Viáº¿t | Auto-fill sau khi Ä‘Äƒng |\n\n---\n\n### âš™ï¸ Cáº¦N Cáº¤U HÃŒNH TRÆ¯á»šC KHI DÃ™NG:\n\n1. **YOUR_GOOGLE_SHEET_ID** - Thay báº±ng ID Google Sheet cá»§a báº¡n\n2. **YOUR_SERPAPI_KEY** - ÄÄƒng kÃ½ táº¡i serpapi.com\n3. **YOUR_TELEGRAM_CHAT_ID** - Láº¥y tá»« @userinfobot\n4. **Google Sheets OAuth2** - Táº¥t cáº£ nodes Google Sheets\n5. **Google Gemini API** - 2 nodes AI\n6. **Facebook Graph API** - Node ÄÄƒng Facebook (cáº§n Page Token tá»« /me/accounts)\n7. **Telegram Bot** - Node thÃ´ng bÃ¡o\n\n---\n\n### ðŸ’° Chi phÃ­ Æ°á»›c tÃ­nh: ~400-1000 VNÄ/bÃ i\n\n### ðŸ“ LÆ°u Ã½ quan trá»ng:\n- Facebook Token cáº§n láº¥y tá»« /me/accounts (Page Token)\n- KHÃ”NG dÃ¹ng User Token, pháº£i dÃ¹ng Page Token\n- Timezone Ä‘Ã£ set sáºµn Asia/Ho_Chi_Minh",
        "height": 780,
        "width": 460
      },
      "id": "7ea58eea-ed10-4c75-be5c-2101fb05bfae",
      "name": "HÆ°á»›ng dáº«n",
      "type": "n8n-nodes-base.stickyNote",
      "position": [5120, 1150],
      "typeVersion": 1
    }
  ],
  "pinData": {},
  "connections": {
    "Cháº¡y má»—i 5 phÃºt": {"main": [[{"node": "Äá»c Google Sheets", "type": "main", "index": 0}]]},
    "Äá»c Google Sheets": {"main": [[{"node": "Lá»c bÃ i cáº§n Ä‘Äƒng", "type": "main", "index": 0}]]},
    "Lá»c bÃ i cáº§n Ä‘Äƒng": {"main": [[{"node": "Cáº­p nháº­t: Äang Ä‘Äƒng", "type": "main", "index": 0}]]},
    "Cáº­p nháº­t: Äang Ä‘Äƒng": {"main": [[{"node": "Äá»c dá»¯ liá»‡u", "type": "main", "index": 0}]]},
    "Äá»c dá»¯ liá»‡u": {"main": [[{"node": "Google Lens - Nháº­n diá»‡n", "type": "main", "index": 0}]]},
    "Google Lens - Nháº­n diá»‡n": {"main": [[{"node": "TrÃ­ch xuáº¥t nháº­n diá»‡n", "type": "main", "index": 0}]]},
    "TrÃ­ch xuáº¥t nháº­n diá»‡n": {"main": [[{"node": "GPT-4 Vision - MÃ´ táº£ hÃ¬nh", "type": "main", "index": 0}]]},
    "GPT-4 Vision - MÃ´ táº£ hÃ¬nh": {"main": [[{"node": "AI - Viáº¿t Caption + Hashtag", "type": "main", "index": 0}]]},
    "Output Parser": {"ai_outputParser": [[{"node": "AI - Viáº¿t Caption + Hashtag", "type": "ai_outputParser", "index": 0}]]},
    "AI - Viáº¿t Caption + Hashtag": {"main": [[{"node": "GhÃ©p Caption + Hashtag", "type": "main", "index": 0}]]},
    "GhÃ©p Caption + Hashtag": {"main": [[{"node": "ÄÄƒng Facebook", "type": "main", "index": 0}]]},
    "ÄÄƒng Facebook": {"main": [[{"node": "Cáº­p nháº­t: ThÃ nh cÃ´ng", "type": "main", "index": 0}]]},
    "Google Gemini Chat Model": {"ai_languageModel": [[{"node": "GPT-4 Vision - MÃ´ táº£ hÃ¬nh", "type": "ai_languageModel", "index": 0}]]},
    "Google Gemini Chat Model1": {"ai_languageModel": [[{"node": "AI - Viáº¿t Caption + Hashtag", "type": "ai_languageModel", "index": 0}]]},
    "Cáº­p nháº­t: ThÃ nh cÃ´ng": {"main": [[{"node": "Send a text message", "type": "main", "index": 0}]]}
  },
  "active": false,
  "settings": {"executionOrder": "v1"},
  "tags": []
}
